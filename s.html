<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <title>ëŠ˜ë´„í•™êµ: ì•„ì´ë“¤ì˜ ë´„ì„ ì°¾ì•„ì„œ</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sun-typeface/SUITE/fonts/variable/woff2/SUITE-Variable.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --spring-start: #fce7f3;
      --spring-mid: #fbcfe8;
      --spring-end: #f9a8d4;
      --primary-text: #831843;
      --secondary-text: #9f1239;
      --highlight-color: #ec4899;
      --warm-gold: #fbbf24;
    }
    
    body {
      font-family: 'SUITE Variable', sans-serif;
      background: linear-gradient(135deg, var(--spring-start), var(--spring-mid), var(--spring-end));
      min-height: 100vh;
      transition: background 1.5s ease;
    }
    
    /* íŠ¸ë£¨ ì—”ë”© í…Œë§ˆ */
    body.true-ending-active {
      --spring-start: #fff7ed;
      --spring-mid: #fed7aa;
      --spring-end: #fdba74;
      --highlight-color: #f59e0b;
      background: linear-gradient(135deg, #fff7ed, #fed7aa, #fdba74);
    }
    
    /* ë°˜ì§ì„ íš¨ê³¼ */
    .sparkle {
      position: absolute;
      width: 8px;
      height: 8px;
      background: var(--highlight-color);
      border-radius: 50%;
      pointer-events: none;
      animation: sparkle-float 1s forwards;
      box-shadow: 0 0 10px var(--highlight-color);
    }
    
    @keyframes sparkle-float {
      0% { transform: scale(0) translate(0, 0); opacity: 1; }
      100% { transform: scale(2) translate(var(--tx), var(--ty)); opacity: 0; }
    }
    
    /* ë²šê½ƒ ë–¨ì–´ì§€ëŠ” íš¨ê³¼ */
    .cherry-blossom {
      position: fixed;
      width: 15px;
      height: 15px;
      pointer-events: none;
      z-index: 9999;
      animation: fall linear forwards;
      opacity: 0.8;
    }
    
    @keyframes fall {
      to {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
    
    /* ìŠ¤í…Œì´ì§€ ì „í™˜ */
    .stage {
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.6s ease;
    }
    
    .stage.visible {
      opacity: 1;
      transform: translateY(0);
    }
    
    .stage.hidden {
      display: none;
    }
    
    /* ì ê¸ˆ íš¨ê³¼ */
    .stage-locked {
      position: relative;
      pointer-events: none;
    }
    
    .stage-locked::after {
      content: 'ğŸ”’';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 4rem;
      opacity: 0.3;
      animation: lock-pulse 2s infinite;
    }
    
    @keyframes lock-pulse {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.1); }
    }
    
    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .game-button {
      background: var(--highlight-color);
      color: white;
      padding: 1rem 2rem;
      border-radius: 9999px;
      font-weight: bold;
      font-size: 1.125rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }
    
    .game-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }
    
    .game-button:active {
      transform: translateY(-1px);
    }
    
    /* ì…ë ¥ í•„ë“œ */
    .input-field {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.75rem;
      transition: all 0.3s ease;
      font-size: 1rem;
    }
    
    .input-field:focus {
      outline: none;
      border-color: var(--highlight-color);
      box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
    }
    
    /* ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
    .custom-checkbox {
      width: 1.5rem;
      height: 1.5rem;
      border: 2px solid #d1d5db;
      border-radius: 0.375rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .custom-checkbox:checked {
      background-color: var(--highlight-color);
      border-color: var(--highlight-color);
    }
    
    /* ì„ íƒ ë²„íŠ¼ */
    .choice-button {
      padding: 1.5rem;
      border: 3px solid #e5e7eb;
      border-radius: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      background: white;
    }
    
    .choice-button:hover {
      border-color: var(--highlight-color);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }
    
    .choice-button.selected {
      border-color: var(--highlight-color);
      background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(236, 72, 153, 0.05));
    }
    
    /* ëª¨ë‹¬ ë°°ê²½ */
    .modal-overlay {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    
    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--highlight-color);
      border-radius: 10px;
    }
    
    /* í…ìŠ¤íŠ¸ ìŠ¤í¬ë¨ë¸” íš¨ê³¼ */
    .scrambled {
      filter: blur(3px);
      user-select: none;
      transition: filter 0.5s ease;
    }
    
    /* ì‹œê°„í‘œ ìŠ¤íƒ€ì¼ */
    .timetable-select {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      transition: all 0.3s ease;
      background: white;
    }
    
    .timetable-select:focus {
      outline: none;
      border-color: var(--highlight-color);
    }
    
    .timetable-select.correct {
      border-color: #10b981;
      background: #d1fae5;
    }
    
    /* ì„±ì¥ ë°” */
    .growth-indicator {
      width: 100%;
      height: 60px;
      background: white;
      border-radius: 30px;
      padding: 8px;
      box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
    }
    
    .growth-bar {
      height: 100%;
      background: linear-gradient(90deg, #ec4899, #f59e0b);
      border-radius: 22px;
      transition: width 0.8s ease;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 1rem;
      font-size: 1.5rem;
    }
    
    /* ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    
    .fade-in {
      animation: fadeIn 0.6s ease forwards;
    }
    
    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .heartbeat {
      animation: heartbeat 1.5s ease infinite;
    }
    
    /* ë©”ì‹œì§€ ë°•ìŠ¤ */
    .message-box {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
      border-left: 4px solid var(--highlight-color);
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      margin: 1rem 0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body>

  <!-- ==================== í”„ë¡¤ë¡œê·¸ í™”ë©´ ==================== -->
  <div id="prologueScreen" class="fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="bg-white/90 backdrop-blur-lg w-full max-w-2xl rounded-3xl shadow-2xl p-8 md:p-12 text-center fade-in">
      <div class="text-7xl mb-6 animate-bounce">ğŸŒ¸</div>
      <h1 class="text-4xl md:text-5xl font-bold mb-4" style="color: var(--primary-text);">
        ëŠ˜ë´„í•™êµ: ì•„ì´ë“¤ì˜ ë´„ì„ ì°¾ì•„ì„œ
      </h1>
      <div class="text-lg text-gray-700 leading-relaxed mb-8 space-y-3">
        <p class="italic">"ëª¨ë“  ì•„ì´ì—ê²ŒëŠ” ìì‹ ë§Œì˜ 'ë´„'ì´ ì°¾ì•„ì˜¬ ê¶Œë¦¬ê°€ ìˆìŠµë‹ˆë‹¤."</p>
        <p>ì´ê²ƒì€ í‰ë²”í•œ ì‹ ì²­ì„œê°€ ì•„ë‹™ë‹ˆë‹¤.<br>
        í•œ ì•„ì´ì˜ ì†Œì¤‘í•œ ì—¬ì •ì„ ì™„ì„±í•˜ëŠ”<br>
        íŠ¹ë³„í•œ ì´ì•¼ê¸°ì…ë‹ˆë‹¤.</p>
      </div>
      <button id="startJourneyBtn" class="game-button">
        ì—¬ì • ì‹œì‘í•˜ê¸° âœ¨
      </button>
    </div>
  </div>

  <!-- ==================== ë©”ì¸ í¼ ==================== -->
  <div id="mainForm" class="hidden container mx-auto max-w-4xl p-4 py-8">
    <!-- ì„±ì¥ ì¸ë””ì¼€ì´í„° -->
    <div class="growth-indicator mb-8">
      <div id="growthBar" class="growth-bar" style="width: 0%;">
        <span id="growthEmoji">ğŸŒ±</span>
      </div>
    </div>

    <div class="bg-white/90 backdrop-blur-lg rounded-3xl shadow-2xl p-6 md:p-10">
      <!-- í—¤ë” -->
      <div class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-bold mb-3" style="color: var(--primary-text);">
          ëŠ˜ë´„í•™êµ ì…í•™ ì—¬ì •
        </h1>
        <p class="text-gray-600 text-lg">
          ì•„ì´ì˜ ë´„ì„ í•¨ê»˜ ì¤€ë¹„í•´ì£¼ì„¸ìš”
        </p>
      </div>

      <form id="applicationForm" class="space-y-8" onsubmit="return false;">
        
        <!-- ==================== ìŠ¤í…Œì´ì§€ 1: ì•½ì†ì˜ ì”¨ì•— ==================== -->
        <section id="stage1" class="stage visible space-y-4 p-6 rounded-2xl bg-gradient-to-br from-pink-50 to-purple-50 shadow-lg">
          <div class="flex items-start gap-4">
            <div id="privacyLock" class="text-5xl cursor-pointer transition-transform hover:scale-110 hover:rotate-12" title="í´ë¦­í•˜ì—¬ ì•½ì† í™•ì¸í•˜ê¸°">
              ğŸ”’
            </div>
            <div class="flex-1">
              <h2 class="text-2xl font-bold mb-3" style="color: var(--primary-text);">
                ì œ 1ì¥: ì•½ì†ì˜ ì”¨ì•—
              </h2>
              <div class="message-box text-sm text-gray-600 mb-4">
                "ì•„ì´ë¥¼ ì§€í‚¤ê² ë‹¤ëŠ” ì²« ë²ˆì§¸ ì•½ì†.<br>ì‹ ë¢°ëŠ” ëª¨ë“  ê´€ê³„ì˜ ì‹œì‘ì…ë‹ˆë‹¤."
              </div>
              
              <div id="privacyNotice" class="bg-white p-4 rounded-lg mb-4 text-sm leading-relaxed scrambled">
                ëŠ˜ë´„í•™êµëŠ” ì•½ì†í•©ë‹ˆë‹¤.
ìš°ë¦¬ê°€ ë§¡ì€ ëª¨ë“  ì•„ì´ë¥¼,
ìš°ë¦¬ ì•„ì´ì²˜ëŸ¼ ì†Œì¤‘í•˜ê²Œ ëŒë³´ê² ìŠµë‹ˆë‹¤.

ì´ ì•½ì†ì€ ë‹¨ìˆœí•œ ë§ì´ ì•„ë‹™ë‹ˆë‹¤.
ìš°ë¦¬ëŠ” ì•„ì´ì˜ ê°œì¸ì •ë³´ë¥¼ ì² ì €íˆ ë³´í˜¸í•˜ê³ ,
ì•„ì´ì˜ ì•ˆì „ì„ ìµœìš°ì„ ìœ¼ë¡œ ìƒê°í•˜ë©°,
ë¶€ëª¨ë‹˜ê³¼ì˜ ì‹ ë¢°ë¥¼ ì§€ì¼œë‚˜ê°€ê² ìŠµë‹ˆë‹¤.

ì´ê²ƒì´ ëŠ˜ë´„í•™êµì˜ ì²« ë²ˆì§¸ ì•½ì†ì…ë‹ˆë‹¤.
              </div>
              
              <label class="flex items-start gap-3 cursor-pointer group">
                <input type="checkbox" id="privacyAgree" class="custom-checkbox mt-1">
                <span class="text-sm font-semibold text-gray-700 group-hover:text-pink-600 transition">
                  í•™êµì˜ ì•½ì†ì„ ì´í•´í•˜ê³  ë¯¿ìŠµë‹ˆë‹¤ ğŸ’–
                </span>
              </label>
            </div>
          </div>
        </section>

        <!-- ==================== ìŠ¤í…Œì´ì§€ 2: ê°ˆë¦¼ê¸¸ì˜ ì„ íƒ ==================== -->
        <section id="stage2" class="stage hidden stage-locked space-y-4 p-6 rounded-2xl bg-gradient-to-br from-blue-50 to-indigo-50 shadow-lg">
          <h2 class="text-2xl font-bold mb-3" style="color: var(--primary-text);">
            ì œ 2ì¥: ê°ˆë¦¼ê¸¸ì˜ ì„ íƒ
          </h2>
          <div class="message-box text-sm text-gray-600 mb-4">
            "ëª¨ë“  ì•„ì´ëŠ” ê°ìì˜ ì´ì•¼ê¸°ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.<br>
            ìƒˆë¡œìš´ ì‹œì‘ì´ë“ , ì´ì–´ì§€ëŠ” ì—¬ì •ì´ë“ , ëª¨ë‘ ì†Œì¤‘í•©ë‹ˆë‹¤."
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <button type="button" class="choice-button" data-path="new">
              <div class="text-5xl mb-3">ğŸŒ±</div>
              <div class="text-xl font-bold mb-2">ìƒˆì‹¹ì˜ ê¸¸</div>
              <div class="text-sm text-gray-600">
                ì²˜ìŒ ì‹œì‘í•˜ëŠ” ëŠ˜ë´„í•™êµ<br>ì„¤ë ˆëŠ” ì²«ê±¸ìŒ
              </div>
            </button>
            
            <button type="button" class="choice-button" data-path="existing">
              <div class="text-5xl mb-3">ğŸŒ³</div>
              <div class="text-xl font-bold mb-2">ì„±ì¥ì˜ ê¸¸</div>
              <div class="text-sm text-gray-600">
                í•¨ê»˜í•œ ì‹œê°„ì„ ì´ì–´ê°€ëŠ”<br>ì†Œì¤‘í•œ ë°œê±¸ìŒ
              </div>
            </button>
          </div>
        </section>

        <!-- ==================== ìŠ¤í…Œì´ì§€ 3: ì•„ì´ì˜ ì´ì•¼ê¸° ==================== -->
        <section id="stage3" class="stage hidden stage-locked space-y-6 p-6 rounded-2xl bg-gradient-to-br from-yellow-50 to-orange-50 shadow-lg">
          <h2 class="text-2xl font-bold mb-3" style="color: var(--primary-text);">
            ì œ 3ì¥: ì•„ì´ì˜ ì´ì•¼ê¸°
          </h2>
          <div class="message-box text-sm text-gray-600 mb-4">
            "ì•„ì´ì˜ ì´ë¦„ì„ ë¶€ë¥´ëŠ” ê²ƒ, ì•„ì´ì˜ ìƒì¼ì„ ê¸°ì–µí•˜ëŠ” ê²ƒ.<br>
            ì´ ëª¨ë“  ê²ƒì´ ì‚¬ë‘ì˜ í‘œí˜„ì…ë‹ˆë‹¤."
          </div>
          
          <div class="space-y-6">
            <!-- í•™ìƒ ì •ë³´ -->
            <div class="bg-white p-6 rounded-xl shadow-sm space-y-4">
              <h3 class="font-bold text-lg text-gray-800 mb-4">ì•„ì´ì˜ ê¸°ë³¸ ì •ë³´</h3>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">
                    ì˜ì›…ì˜ ì´ë¦„ âœ¨
                  </label>
                  <input 
                    type="text" 
                    id="studentName" 
                    class="input-field" 
                    placeholder="ì•„ì´ì˜ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                  >
                  <p class="text-xs text-gray-500 mt-1">ì´ë¦„ì„ ë¶€ë¥´ëŠ” ìˆœê°„, ì´ì•¼ê¸°ê°€ ì‹œì‘ë©ë‹ˆë‹¤</p>
                </div>
                
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">
                    íƒ„ìƒì˜ ìˆœê°„ ğŸ‚
                  </label>
                  <input 
                    type="date" 
                    id="birthDate" 
                    class="input-field"
                  >
                  <p class="text-xs text-gray-500 mt-1">ì•„ì´ê°€ ì„¸ìƒì— ì˜¨ íŠ¹ë³„í•œ ë‚ </p>
                </div>
              </div>
            </div>
            
            <!-- í•™ë¶€ëª¨ ì •ë³´ -->
            <div class="bg-white p-6 rounded-xl shadow-sm space-y-4">
              <h3 class="font-bold text-lg text-gray-800 mb-4">ìˆ˜í˜¸ìì˜ ì •ë³´</h3>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">
                    ìˆ˜í˜¸ìì˜ ì´ë¦„ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦
                  </label>
                  <input 
                    type="text" 
                    id="parentName" 
                    class="input-field" 
                    placeholder="ë‹¹ì‹ ì˜ ì´ë¦„ì„ ì•Œë ¤ì£¼ì„¸ìš”"
                  >
                  <p class="text-xs text-gray-500 mt-1">ì•„ì´ ê³ì—ì„œ ëŠ˜ í•¨ê»˜í•˜ëŠ” ì´ë¦„</p>
                </div>
                
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">
                    ì—°ê²°ì˜ ë§ˆë²• ğŸ“
                  </label>
                  <input 
                    type="tel" 
                    id="parentContact" 
                    class="input-field" 
                    placeholder="010-0000-0000"
                    maxlength="13"
                  >
                  <p class="text-xs text-pink-600 mt-1 font-medium">
                    ğŸ’¡ íŒíŠ¸: ì²œì‚¬ë¥¼ ëœ»í•˜ëŠ” ìˆ«ì '1004'ë¥¼ ê¸°ì–µí•˜ì‹œë‚˜ìš”?
                  </p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- ==================== ìŠ¤í…Œì´ì§€ 4: ì‹œê°„ì˜ ì •ì› ==================== -->
        <section id="stage4" class="stage hidden stage-locked space-y-6 p-6 rounded-2xl bg-gradient-to-br from-green-50 to-teal-50 shadow-lg">
          <h2 class="text-2xl font-bold mb-3" style="color: var(--primary-text);">
            ì œ 4ì¥: ì‹œê°„ì˜ ì •ì›
          </h2>
          <div class="message-box text-sm text-gray-600 mb-4">
            "ì•„ì´ì˜ í•˜ë£¨ëŠ” 24ì‹œê°„ì…ë‹ˆë‹¤.<br>
            ê·¸ ì¤‘ ë°©ê³¼ í›„ ì‹œê°„ì„ ì–´ë–»ê²Œ ì±„ìš¸ì§€ëŠ” ë¶€ëª¨ë‹˜ì˜ ì§€í˜œê°€ í•„ìš”í•©ë‹ˆë‹¤."
          </div>
          
          <div class="bg-purple-100 p-4 rounded-xl text-center mb-4">
            <p class="text-sm font-semibold" style="color: var(--secondary-text);">
              "ì›”ìš”ì¼ì—” <span style="color: var(--highlight-color);">ëŒë³´ëŠ” ë§ˆìŒ</span>, 
              ìˆ˜ìš”ì¼ì—” <span style="color: var(--highlight-color);">ë§ì¶¤í˜• ì§€í˜œ</span>, 
              ê¸ˆìš”ì¼ì—” <span style="color: var(--highlight-color);">ìƒˆë¡œìš´ êµìœ¡</span>ì˜ ì”¨ì•—ì„ ì‹¬ìœ¼ì„¸ìš”."
            </p>
          </div>
          
          <div class="bg-white p-6 rounded-xl shadow-sm overflow-x-auto">
            <table class="w-full text-center text-sm" id="timetable">
              <thead>
                <tr class="border-b-2 border-gray-300">
                  <th class="p-2 font-bold text-gray-700">êµì‹œ</th>
                  <th class="p-2 font-bold text-gray-700">ì›”</th>
                  <th class="p-2 font-bold text-gray-700">í™”</th>
                  <th class="p-2 font-bold text-gray-700">ìˆ˜</th>
                  <th class="p-2 font-bold text-gray-700">ëª©</th>
                  <th class="p-2 font-bold text-gray-700">ê¸ˆ</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="p-2 font-semibold text-gray-600">1êµì‹œ</td>
                  <td class="p-2"><select class="timetable-select" data-day="ì›”" data-period="1"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                  <td class="p-2"><select class="timetable-select" data-day="í™”" data-period="1"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                  <td class="p-2"><select class="timetable-select" data-day="ìˆ˜" data-period="1"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                  <td class="p-2"><select class="timetable-select" data-day="ëª©" data-period="1"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                  <td class="p-2"><select class="timetable-select" data-day="ê¸ˆ" data-period="1"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                </tr>
                <tr class="bg-gray-50">
                  <td class="p-2 font-semibold text-gray-600">2êµì‹œ</td>
                  <td class="p-2"><select class="timetable-select" data-day="ì›”" data-period="2"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                  <td class="p-2"><select class="timetable-select" data-day="í™”" data-period="2"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                  <td class="p-2"><select class="timetable-select" data-day="ìˆ˜" data-period="2"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                  <td class="p-2"><select class="timetable-select" data-day="ëª©" data-period="2"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                  <td class="p-2"><select class="timetable-select" data-day="ê¸ˆ" data-period="2"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                </tr>
                <tr>
                  <td class="p-2 font-semibold text-gray-600">3êµì‹œ</td>
                  <td class="p-2"><select class="timetable-select" data-day="ì›”" data-period="3"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                  <td class="p-2"><select class="timetable-select" data-day="í™”" data-period="3"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                  <td class="p-2"><select class="timetable-select" data-day="ìˆ˜" data-period="3"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                  <td class="p-2"><select class="timetable-select" data-day="ëª©" data-period="3"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                  <td class="p-2"><select class="timetable-select" data-day="ê¸ˆ" data-period="3"><option value="">ì„ íƒ</option><option value="ì„ íƒí˜• ëŒë´„">ì„ íƒí˜• ëŒë´„</option><option value="ë§ì¶¤í˜•">ë§ì¶¤í˜•</option><option value="ì„ íƒí˜• êµìœ¡">ì„ íƒí˜• êµìœ¡(ì˜ˆì •)</option></select></td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div id="timetableHint" class="hidden message-box text-sm">
            <p class="font-semibold text-green-600">âœ¨ í›Œë¥­í•©ë‹ˆë‹¤!</p>
            <p class="text-gray-600 mt-1">ëŒë´„ê³¼ ë°°ì›€, ê·¸ë¦¬ê³  ìƒˆë¡œìš´ ê²½í—˜... ì•„ì´ì—ê²Œ í•„ìš”í•œ ëª¨ë“  ê²ƒì„ ìƒê°í•˜ì…¨êµ°ìš”!</p>
          </div>
        </section>

        <!-- ==================== ìŠ¤í…Œì´ì§€ 5: ë™í–‰ì˜ ì•½ì† ==================== -->
        <section id="stage5" class="stage hidden stage-locked space-y-6 p-6 rounded-2xl bg-gradient-to-br from-red-50 to-pink-50 shadow-lg">
          <h2 id="stage5Title" class="text-2xl font-bold mb-3" style="color: var(--primary-text);">
            ì œ 5ì¥: ë™í–‰ì˜ ì•½ì†
          </h2>
          <div id="stage5Message" class="message-box text-sm text-gray-600 mb-4">
            "ì•„ì´ë¥¼ í‚¤ìš°ëŠ” ë°ëŠ” ì˜¨ ë§ˆì„ì´ í•„ìš”í•©ë‹ˆë‹¤.<br>
            í•˜ì§€ë§Œ ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€ ë¶€ëª¨ë‹˜ ìì‹ ì…ë‹ˆë‹¤."
          </div>
          
          <div class="bg-amber-100 p-4 rounded-xl text-center mb-4">
            <p class="text-sm font-semibold" style="color: var(--secondary-text);">
              "ì•„ì´ì˜ ê°€ì¥ ë“ ë“ í•œ ì²« ë²ˆì§¸ ë™í–‰ìëŠ”<br>
              ë°”ë¡œ <span style="color: var(--highlight-color);">ë‹¹ì‹ </span>ì…ë‹ˆë‹¤."
            </p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-white p-6 rounded-xl shadow-sm">
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                ğŸ‘¤ ì²« ë²ˆì§¸ ë™í–‰ì
              </label>
              <input 
                type="text" 
                id="companion1" 
                class="input-field" 
                placeholder="ì²« ë²ˆì§¸ ë™í–‰ìì˜ ì´ë¦„"
              >
              <p class="text-xs text-gray-500 mt-2">
                ì•ì„œ ì…ë ¥í•˜ì‹  ìˆ˜í˜¸ìì˜ ì´ë¦„ì„ ê¸°ì–µí•˜ì‹œë‚˜ìš”?
              </p>
            </div>
            
            <div class="bg-white p-6 rounded-xl shadow-sm">
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                ğŸ‘¤ ë‘ ë²ˆì§¸ ë™í–‰ì
              </label>
              <input 
                type="text" 
                id="companion2" 
                class="input-field" 
                placeholder="ë‘ ë²ˆì§¸ ë™í–‰ìì˜ ì´ë¦„ (ì„ íƒ)"
              >
              <p class="text-xs text-gray-500 mt-2">
                í•¨ê»˜ ì•„ì´ë¥¼ ëŒë³¼ ì†Œì¤‘í•œ ë¶„
              </p>
            </div>
          </div>
        </section>

        <!-- ==================== ì œì¶œ ë²„íŠ¼ ==================== -->
        <div id="submitContainer" class="hidden pt-6 text-center">
          <button type="submit" id="submitBtn" class="game-button text-xl px-12 py-5 heartbeat">
            ğŸŒ¸ ì…í•™ ì‹ ì²­ì„œ ì œì¶œí•˜ê¸°
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ==================== ì¼ë°˜ ì—”ë”© ëª¨ë‹¬ ==================== -->
  <div id="normalEndingModal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full p-8 md:p-12 fade-in">
      <div class="text-7xl text-center mb-6 animate-bounce">ğŸ‰</div>
      <h2 class="text-4xl font-bold text-center mb-4" style="color: var(--primary-text);">
        ì…í•™ì„ ì¶•í•˜í•©ë‹ˆë‹¤!
      </h2>
      <div class="text-center text-lg text-gray-700 mb-6">
        <span id="endingStudentName" class="font-bold" style="color: var(--highlight-color);"></span> í•™ìƒì˜<br>
        ëŠ˜ë´„í•™êµ ì…í•™ì´ í—ˆê°€ë˜ì—ˆìŠµë‹ˆë‹¤.
      </div>
      
      <div class="bg-gradient-to-br from-pink-50 to-purple-50 p-6 rounded-2xl mb-6">
        <h3 class="font-bold text-center mb-4 text-gray-800">ì™„ì„±ëœ ì‹œê°„í‘œ</h3>
        <div id="endingTimetable" class="text-sm"></div>
      </div>
      
      <div class="message-box text-center">
        <p class="text-gray-700 leading-relaxed">
          ë¶€ëª¨ë‹˜ì˜ ì„¸ì‹¬í•œ ê´€ì‹¬ê³¼ ì‚¬ë‘ìœ¼ë¡œ<br>
          ì•„ì´ì˜ ì—¬ì •ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>
          ì•„ì´ì—ê²Œ ê°€ì¥ í° ë´„ì€<br>
          ì–¸ì œë‚˜ ë¶€ëª¨ë‹˜, ë‹¹ì‹ ì…ë‹ˆë‹¤. ğŸ’–
        </p>
      </div>
      
      <div class="text-center mt-8">
        <button onclick="location.reload()" class="game-button">
          ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°
        </button>
      </div>
    </div>
  </div>

  <!-- ==================== íŠ¸ë£¨ ì—”ë”© ëª¨ë‹¬ ==================== -->
  <div id="trueEndingModal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col fade-in">
      <div id="storyHeader" class="p-8 text-center text-white" style="background: linear-gradient(135deg, #ec4899, #f59e0b);">
        <h2 id="storyTitle" class="text-3xl font-bold mb-2"></h2>
        <p id="storySubtitle" class="text-lg opacity-90"></p>
      </div>
      
      <div id="storyContent" class="flex-1 overflow-y-auto p-8">
        <!-- ìŠ¤í† ë¦¬ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
      </div>
      
      <div class="border-t bg-gray-50 p-6 flex justify-between items-center">
        <button id="prevChapterBtn" class="px-6 py-3 rounded-xl border-2 border-gray-300 font-semibold text-gray-700 hover:border-pink-500 transition disabled:opacity-30 disabled:cursor-not-allowed">
          â† ì´ì „
        </button>
        <div id="chapterIndicator" class="text-sm font-semibold text-gray-600"></div>
        <button id="nextChapterBtn" class="px-6 py-3 rounded-xl font-semibold text-white transition" style="background: var(--highlight-color);">
          ë‹¤ìŒ â†’
        </button>
      </div>
    </div>
  </div>

  <!-- ==================== JavaScript ==================== -->
  <script>
    // ==================== ê²Œì„ ìƒíƒœ ê´€ë¦¬ ====================
    const gameState = {
      currentStage: 1,
      growth: 0,
      isTrueEnding: false,
      studentName: '',
      parentName: '',
      timetableRiddle: {
        mon: false,
        wed: false,
        fri: false
      },
      dataCollected: {
        birthDate: '',
        parentContact: '',
        studentType: '',
        timetable: {},
        companions: []
      }
    };

    // ==================== ì‚¬ìš´ë“œ ê´€ë¦¬ ====================
    const sounds = {
      unlock: new Audio('https://cdn.pixabay.com/download/audio/2021/08/04/audio_dea41b359c.mp3?filename=magic-wand-1-101wand.wav'),
      success: new Audio('https://cdn.pixabay.com/download/audio/2022/01/21/audio_ea3b022213.mp3?filename=success-1-6297.mp3'),
      sparkle: new Audio('https://cdn.pixabay.com/download/audio/2022/03/10/audio_c29d3bce2e.mp3?filename=fantasy-magical-sparkle-swoosh-1-101sparkle.wav'),
      trueEnding: new Audio('https://cdn.pixabay.com/download/audio/2022/11/17/audio_855845ce37.mp3?filename=a-small-miracle-120390.mp3')
    };

    // ë³¼ë¥¨ ì„¤ì •
    Object.values(sounds).forEach(sound => {
      sound.volume = 0.4;
    });

    function playSound(soundName) {
      if (sounds[soundName]) {
        sounds[soundName].currentTime = 0;
        sounds[soundName].play().catch(e => console.log('Sound play failed:', e));
      }
    }

    // ==================== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ====================
    
    // í…ìŠ¤íŠ¸ ìŠ¤í¬ë¨ë¸” íš¨ê³¼
    function scrambleText(text) {
      return text.split('').map(char => {
        if (char.match(/[ê°€-í£]/)) {
          return String.fromCharCode(0xAC00 + Math.floor(Math.random() * 11172));
        }
        return char;
      }).join('');
    }

    // ë°˜ì§ì„ íš¨ê³¼ ìƒì„±
    function createSparkles(element) {
      const rect = element.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      for (let i = 0; i < 30; i++) {
        setTimeout(() => {
          const sparkle = document.createElement('div');
          sparkle.className = 'sparkle';
          
          const angle = (Math.PI * 2 * i) / 30;
          const distance = 50 + Math.random() * 50;
          const tx = Math.cos(angle) * distance;
          const ty = Math.sin(angle) * distance;
          
          sparkle.style.left = centerX + 'px';
          sparkle.style.top = centerY + 'px';
          sparkle.style.setProperty('--tx', tx + 'px');
          sparkle.style.setProperty('--ty', ty + 'px');
          
          document.body.appendChild(sparkle);
          
          setTimeout(() => sparkle.remove(), 1000);
        }, i * 20);
      }
      
      playSound('sparkle');
    }

    // ë²šê½ƒ ë–¨ì–´ì§€ëŠ” íš¨ê³¼
    function createCherryBlossoms() {
      setInterval(() => {
        const blossom = document.createElement('div');
        blossom.className = 'cherry-blossom';
        blossom.textContent = 'ğŸŒ¸';
        blossom.style.left = Math.random() * 100 + 'vw';
        blossom.style.animationDuration = (Math.random() * 3 + 4) + 's';
        blossom.style.fontSize = (Math.random() * 10 + 15) + 'px';
        
        document.body.appendChild(blossom);
        
        setTimeout(() => blossom.remove(), 7000);
      }, 800);
    }

    // ì„±ì¥ ë°” ì—…ë°ì´íŠ¸
    function updateGrowth(percentage) {
      gameState.growth = percentage;
      const growthBar = document.getElementById('growthBar');
      const growthEmoji = document.getElementById('growthEmoji');
      
      growthBar.style.width = percentage + '%';
      
      // ì´ëª¨ì§€ ë³€í™”
      if (percentage >= 100) growthEmoji.textContent = 'ğŸŒ¸';
      else if (percentage >= 80) growthEmoji.textContent = 'ğŸŒº';
      else if (percentage >= 60) growthEmoji.textContent = 'ğŸŒ»';
      else if (percentage >= 40) growthEmoji.textContent = 'ğŸŒ¿';
      else if (percentage >= 20) growthEmoji.textContent = 'ğŸŒ±';
    }

    // ìŠ¤í…Œì´ì§€ í‘œì‹œ
    function showStage(stageNumber) {
      const stage = document.getElementById('stage' + stageNumber);
      if (!stage) return;
      
      stage.classList.remove('hidden', 'stage-locked');
      stage.classList.add('visible');
      
      setTimeout(() => {
        stage.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 300);
      
      playSound('unlock');
      gameState.currentStage = stageNumber;
    }

    // ==================== ìŠ¤í…Œì´ì§€ 1: ì•½ì†ì˜ ì”¨ì•— ====================
    function initStage1() {
      const lock = document.getElementById('privacyLock');
      const notice = document.getElementById('privacyNotice');
      const checkbox = document.getElementById('privacyAgree');
      
      let isUnlocked = false;
      
      lock.addEventListener('click', () => {
        if (!isUnlocked) {
          notice.classList.remove('scrambled');
          lock.textContent = 'ğŸ”“';
          isUnlocked = true;
          playSound('unlock');
          
          createSparkles(lock);
        }
      });
      
      checkbox.addEventListener('change', (e) => {
        if (e.target.checked && isUnlocked) {
          playSound('success');
          updateGrowth(20);
          setTimeout(() => showStage(2), 500);
        } else if (e.target.checked && !isUnlocked) {
          e.target.checked = false;
          alert('ë¨¼ì € ìë¬¼ì‡ ë¥¼ í´ë¦­í•˜ì—¬ ì•½ì†ì˜ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”! ğŸ”’');
        }
      });
    }

    // ==================== ìŠ¤í…Œì´ì§€ 2: ê°ˆë¦¼ê¸¸ì˜ ì„ íƒ ====================
    function initStage2() {
      const pathButtons = document.querySelectorAll('[data-path]');
      
      pathButtons.forEach(button => {
        button.addEventListener('click', () => {
          pathButtons.forEach(btn => btn.classList.remove('selected'));
          button.classList.add('selected');
          
          gameState.dataCollected.studentType = button.dataset.path;
          
          playSound('success');
          updateGrowth(40);
          setTimeout(() => showStage(3), 500);
        });
      });
    }

    // ==================== ìŠ¤í…Œì´ì§€ 3: ì•„ì´ì˜ ì´ì•¼ê¸° ====================
    function initStage3() {
      const studentNameInput = document.getElementById('studentName');
      const birthDateInput = document.getElementById('birthDate');
      const parentNameInput = document.getElementById('parentName');
      const parentContactInput = document.getElementById('parentContact');
      
      // ì—°ë½ì²˜ ìë™ í¬ë§·íŒ…
      parentContactInput.addEventListener('input', (e) => {
        let value = e.target.value.replace(/[^\d]/g, '');
        
        if (value.length <= 3) {
          e.target.value = value;
        } else if (value.length <= 7) {
          e.target.value = value.slice(0, 3) + '-' + value.slice(3);
        } else {
          e.target.value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
        }
        
        checkStage3Completion();
      });
      
      // í•™ìƒ ì´ë¦„ ì…ë ¥ - íŠ¸ë£¨ ì—”ë”© íŠ¸ë¦¬ê±°
      studentNameInput.addEventListener('input', () => {
        const name = studentNameInput.value.trim();
        gameState.studentName = name;
        
        // íŠ¸ë£¨ ì—”ë”© ì¡°ê±´: ê¹€ì •ì„¤
        if (name === 'ê¹€ì •ì„¤' && !gameState.isTrueEnding) {
          activateTrueEndingMode();
        }
        
        checkStage3Completion();
      });
      
      parentNameInput.addEventListener('input', () => {
        gameState.parentName = parentNameInput.value.trim();
        checkStage3Completion();
      });
      
      birthDateInput.addEventListener('change', checkStage3Completion);
      
      function checkStage3Completion() {
        const hasStudentName = gameState.studentName.length > 0;
        const hasBirthDate = birthDateInput.value.length > 0;
        const hasParentName = gameState.parentName.length > 0;
        const hasAngel = parentContactInput.value.includes('1004');
        
        if (hasStudentName && hasBirthDate && hasParentName && hasAngel) {
          gameState.dataCollected.birthDate = birthDateInput.value;
          gameState.dataCollected.parentContact = parentContactInput.value;
          
          playSound('success');
          createSparkles(parentContactInput);
          updateGrowth(60);
          setTimeout(() => showStage(4), 800);
        }
      }
    }

    // íŠ¸ë£¨ ì—”ë”© ëª¨ë“œ í™œì„±í™”
    function activateTrueEndingMode() {
      gameState.isTrueEnding = true;
      
      // í…Œë§ˆ ë³€ê²½
      document.body.classList.add('true-ending-active');
      
      // ë°°ê²½ìŒì•… ì‹œì‘
      sounds.trueEnding.loop = true;
      sounds.trueEnding.volume = 0.3;
      sounds.trueEnding.play();
      
      // ë²šê½ƒ íš¨ê³¼
      createCherryBlossoms();
      
      // ìŠ¤íŒŒí´ íš¨ê³¼
      const nameInput = document.getElementById('studentName');
      createSparkles(nameInput);
      
      console.log('ğŸŒ¸ íŠ¸ë£¨ ì—”ë”© ëª¨ë“œ í™œì„±í™”! Sì˜ ì´ì•¼ê¸°ê°€ ì‹œì‘ë©ë‹ˆë‹¤...');
    }

    // ==================== ìŠ¤í…Œì´ì§€ 4: ì‹œê°„ì˜ ì •ì› ====================
    function initStage4() {
      const selects = document.querySelectorAll('.timetable-select');
      
      selects.forEach(select => {
        select.addEventListener('change', (e) => {
          const day = e.target.dataset.day;
          const value = e.target.value;
          
          // í¼ì¦ ê²€ì¦
          if (day === 'ì›”' && value.includes('ëŒë´„')) {
            gameState.timetableRiddle.mon = true;
            e.target.classList.add('correct');
          }
          
          if (day === 'ìˆ˜' && value.includes('ë§ì¶¤í˜•')) {
            gameState.timetableRiddle.wed = true;
            e.target.classList.add('correct');
          }
          
          if (day === 'ê¸ˆ' && value.includes('êµìœ¡')) {
            gameState.timetableRiddle.fri = true;
            e.target.classList.add('correct');
          }
          
          // ì‹œê°„í‘œ ë°ì´í„° ì €ì¥
          if (!gameState.dataCollected.timetable[day]) {
            gameState.dataCollected.timetable[day] = {};
          }
          gameState.dataCollected.timetable[day][e.target.dataset.period] = value;
          
          checkTimetableCompletion();
        });
      });
      
      function checkTimetableCompletion() {
        const { mon, wed, fri } = gameState.timetableRiddle;
        
        if (mon && wed && fri) {
          document.getElementById('timetableHint').classList.remove('hidden');
          playSound('success');
          updateGrowth(80);
          
          setTimeout(() => {
            showStage(5);
          }, 1000);
        }
      }
    }

    // ==================== ìŠ¤í…Œì´ì§€ 5: ë™í–‰ì˜ ì•½ì† ====================
    function initStage5() {
      const companion1Input = document.getElementById('companion1');
      const companion2Input = document.getElementById('companion2');
      
      companion1Input.addEventListener('input', () => {
        const name = companion1Input.value.trim();
        
        if (gameState.isTrueEnding) {
          // íŠ¸ë£¨ ì—”ë”©: ì†ì§€í›ˆì„ ì…ë ¥í•´ì•¼ í•¨
          if (name === 'ì†ì§€í›ˆ') {
            activateFinalTrueEnding();
          }
        } else {
          // ì¼ë°˜ ì—”ë”©: ë¶€ëª¨ ì´ë¦„ê³¼ ê°™ì•„ì•¼ í•¨
          if (name === gameState.parentName) {
            unlockSubmit();
          }
        }
      });
    }

    // íŠ¸ë£¨ ì—”ë”© ìµœì¢… í™œì„±í™”
    function activateFinalTrueEnding() {
      createSparkles(document.getElementById('companion1'));
      
      // ìŠ¤í…Œì´ì§€ 5 í…ìŠ¤íŠ¸ ë³€ê²½
      document.getElementById('stage5Title').innerHTML = 'ì œ 5ì¥: Hì˜ ì•½ì† ğŸ’';
      document.getElementById('stage5Message').innerHTML = `
        <p class="text-sm text-gray-700 leading-relaxed">
          ...ì°¾ìœ¼ì…¨êµ°ìš”.<br><br>
          <span class="font-bold" style="color: var(--highlight-color);">Sì˜ ì´ì•¼ê¸°</span> ê³ì—ëŠ”<br>
          ì–¸ì œë‚˜ <span class="font-bold" style="color: var(--highlight-color);">Hê°€</span> ìˆë‹¤ëŠ” ê²ƒì„.<br><br>
          ì´ ì—¬ì •ì€ Hê°€ Së¥¼ ìœ„í•´ ë§Œë“ <br>
          'ì‚¬ê³„ì ˆì˜ ë¹„ë°€' ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.
        </p>
      `;
      
      unlockSubmit(true);
    }

    // ì œì¶œ ë²„íŠ¼ í™œì„±í™”
    function unlockSubmit(isTrueEnding = false) {
      playSound('success');
      updateGrowth(100);
      
      const submitContainer = document.getElementById('submitContainer');
      const submitBtn = document.getElementById('submitBtn');
      
      submitContainer.classList.remove('hidden');
      
      if (isTrueEnding) {
        submitBtn.textContent = 'ğŸ’– ì§„ì§œ ì´ì•¼ê¸° ì—´ê¸°';
        submitBtn.classList.add('true-ending-btn');
      }
      
      setTimeout(() => {
        submitBtn.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 300);
    }

    // ==================== í¼ ì œì¶œ ì²˜ë¦¬ ====================
    function handleSubmit(e) {
      e.preventDefault();
      
      if (gameState.isTrueEnding) {
        showTrueEnding();
      } else {
        showNormalEnding();
      }
    }

    // ==================== ì¼ë°˜ ì—”ë”© ====================
    function showNormalEnding() {
      sounds.trueEnding.pause();
      playSound('success');
      
      document.getElementById('endingStudentName').textContent = gameState.studentName;
      
      // ì‹œê°„í‘œ ë³µì‚¬
      const timetableClone = document.getElementById('timetable').cloneNode(true);
      document.getElementById('endingTimetable').innerHTML = '';
      document.getElementById('endingTimetable').appendChild(timetableClone);
      
      document.getElementById('mainForm').classList.add('hidden');
      document.getElementById('normalEndingModal').classList.remove('hidden');
    }

    // ==================== íŠ¸ë£¨ ì—”ë”© ====================
    function showTrueEnding() {
      const story = {
        chapters: [
          {
            emoji: 'ğŸ’Œ',
            title: 'í”„ë¡¤ë¡œê·¸',
            subtitle: 'ì´ ì‘ì€ ë¹„ë°€ì„ ì°¾ì•„ì£¼ì…”ì„œ',
            color: 'linear-gradient(135deg, #fce7f3, #fbcfe8)',
            content: `
              <div class="text-center space-y-6">
                <div class="text-6xl mb-4">ğŸ’ŒğŸ“œâœ¨</div>
                <div class="text-lg text-gray-800 leading-relaxed space-y-4">
                  <p class="font-semibold text-2xl" style="color: var(--highlight-color);">
                    ì´ ì‘ì€ ì—¬ì •ì„ ì°¾ì•„ì£¼ì…”ì„œ ê³ ë§™ìŠµë‹ˆë‹¤.
                  </p>
                  
                  <p>
                    ë‹¹ì‹ ì´ ë°©ê¸ˆ ëë§ˆì¹œ ì´ ì…í•™ ì‹ ì²­ì„œëŠ”,<br>
                    <span class="font-bold">Hê°€ Së¥¼ ìœ„í•´ ë§Œë“ </span><br>
                    ìˆ˜ë§ì€ 'ì‚¬ê³„ì ˆì˜ ë¹„ë°€' ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.
                  </p>
                  
                  <p>
                    Sê°€ ëŠ˜ ë´„ì²˜ëŸ¼ ë”°ëœ»í•œ ì„¸ìƒì—ì„œ<br>
                    í–‰ë³µí•˜ê¸°ë¥¼ ë°”ë¼ëŠ” ë§ˆìŒìœ¼ë¡œ,<br>
                    HëŠ” ì½”ë“œë¥¼ í†µí•´ ì‘ì€ ì„¸ìƒì„ ë§Œë“¤ê³ ,<br>
                    ê·¸ ì•ˆì— ë‘˜ë§Œì˜ ì´ì•¼ê¸°ë¥¼ ìˆ¨ê²¨ë‘ì—ˆìŠµë‹ˆë‹¤.
                  </p>
                  
                  <p class="text-xl font-semibold" style="color: var(--secondary-text);">
                    ì´ì œ, ê·¸ ì´ì•¼ê¸°ì˜ ì§„ì§œ ì‹œì‘ì„<br>
                    ë“¤ë ¤ë“œë¦´ê²Œìš”. ğŸŒ¸
                  </p>
                </div>
              </div>
            `
          },
          {
            emoji: 'ğŸŒ¸',
            title: 'ë´„: ì‹œì‘',
            subtitle: 'ë‘ ì¹œêµ¬ì˜ íŠ¹ë³„í•œ ì„ë¬´',
            color: 'linear-gradient(135deg, #fce7f3, #fef3c7)',
            content: `
              <div class="space-y-6">
                <div class="text-6xl text-center mb-4">ğŸŒ¸ğŸ’»ğŸŒ±</div>
                <div class="text-lg text-gray-800 leading-relaxed space-y-4">
                  <p>
                    ì–´ëŠ ë´„ë‚ , ë‘ ì¹œêµ¬ <span class="font-bold text-pink-600">S</span>ì™€ 
                    <span class="font-bold text-orange-600">H</span>ëŠ”<br>
                    íŠ¹ë³„í•œ ì„ë¬´ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.
                  </p>
                  
                  <div class="bg-pink-50 p-4 rounded-xl border-l-4 border-pink-400">
                    <p class="font-semibold text-pink-700">
                      "ì‚¬ê³„ì ˆì´ ì™œ ìˆœì„œëŒ€ë¡œ ì˜¤ëŠ”ì§€<br>
                      ì•„ë¬´ë„ ëª¨ë¥¸ë‹¤ëŠ” ê±°ì•¼!"
                    </p>
                  </div>
                  
                  <p>
                    í˜¸ê¸°ì‹¬ ë§ì€ Sê°€ ë…¸íŠ¸ë¶ì„ ì—´ì—ˆê³ ,<br>
                    ë”°ëœ»í•œ ë§ˆìŒì„ ê°€ì§„ Hê°€ ì•„ì´ë””ì–´ë¥¼ ëƒˆìŠµë‹ˆë‹¤.
                  </p>
                  
                  <div class="bg-orange-50 p-4 rounded-xl border-l-4 border-orange-400">
                    <p class="font-semibold text-orange-700">
                      "ìš°ë¦¬ê°€ ì§ì ‘ ì•Œì•„ë‚´ë³´ì!"
                    </p>
                  </div>
                  
                  <p class="text-center text-2xl">
                    ê·¸ë ‡ê²Œ ì—¬ì •ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.
                  </p>
                </div>
              </div>
            `
          },
          {
            emoji: 'â˜€ï¸',
            title: 'ì—¬ë¦„: ì—´ì •',
            subtitle: 'ì½”ë“œì˜ ë°”ë‹¤ë¥¼ í—¤ì—„ì¹˜ë©°',
            color: 'linear-gradient(135deg, #fef3c7, #fed7aa)',
            content: `
              <div class="space-y-6">
                <div class="text-6xl text-center mb-4">â˜€ï¸ğŸ’ªâŒ¨ï¸</div>
                <div class="text-lg text-gray-800 leading-relaxed space-y-4">
                  <p>
                    ëœ¨ê±°ìš´ ì—¬ë¦„,<br>
                    ë‘ ì¹œêµ¬ëŠ” ì½”ë“œì˜ ë°”ë‹¤ë¥¼ í—¤ì—„ì³¤ìŠµë‹ˆë‹¤.
                  </p>
                  
                  <p>
                    ë°¤ë‚®ì—†ì´ í‚¤ë³´ë“œë¥¼ ë‘ë“œë¦¬ë©°,<br>
                    í•œ ì¤„ í•œ ì¤„ í”„ë¡œê·¸ë¨ì„ ë§Œë“¤ì–´ê°”ì–´ìš”.
                  </p>
                  
                  <div class="bg-yellow-50 p-6 rounded-xl border-2 border-yellow-300">
                    <p class="font-bold text-2xl text-yellow-700 mb-2">
                      "ëŠ˜ë´„í†¡í†¡"
                    </p>
                    <p class="text-yellow-600">
                      ì´ë¼ëŠ” ì´ë¦„ë„ ì´ë•Œ íƒ„ìƒí–ˆìŠµë‹ˆë‹¤.
                    </p>
                  </div>
                  
                  <p>
                    <span class="font-semibold">ëŠ˜</span> <span class="font-semibold">ë´„</span>ì²˜ëŸ¼ 
                    ë”°ëœ»í•œ ë§ˆìŒìœ¼ë¡œ<br>
                    ì•„ì´ë“¤ì„ ëŒë³´ëŠ” ì‹œìŠ¤í…œ...
                  </p>
                  
                  <p class="text-center">
                    ê·¸ê²ƒì´ ë‘ ì¹œêµ¬ì˜ ê¿ˆì´ì—ˆìŠµë‹ˆë‹¤. âœ¨
                  </p>
                </div>
              </div>
            `
          },
          {
            emoji: 'ğŸ‚',
            title: 'ê°€ì„: ë°œê²¬',
            subtitle: 'ì‚¬ê³„ì ˆì˜ ë¹„ë°€ì„ ì°¾ë‹¤',
            color: 'linear-gradient(135deg, #fed7aa, #fecaca)',
            content: `
              <div class="space-y-6">
                <div class="text-6xl text-center mb-4">ğŸ‚ğŸ”âœ¨</div>
                <div class="text-lg text-gray-800 leading-relaxed space-y-4">
                  <p>
                    ë‚™ì—½ì´ ë–¨ì–´ì§€ëŠ” ê°€ì„,<br>
                    ë“œë””ì–´ ë¹„ë°€ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!
                  </p>
                  
                  <div class="bg-orange-100 p-6 rounded-xl border-2 border-orange-400">
                    <p class="font-bold text-2xl text-orange-700 mb-4">
                      ì‚¬ê³„ì ˆì˜ ìˆœí™˜ì€...
                    </p>
                    <p class="text-orange-800 leading-relaxed">
                      ë°”ë¡œ <span class="font-bold">'ë³€í™”'</span>ì™€ <span class="font-bold">'ì„±ì¥'</span>!<br><br>
                      ë´„ì˜ ì„¤ë ˜ ğŸŒ¸<br>
                      ì—¬ë¦„ì˜ ì—´ì • â˜€ï¸<br>
                      ê°€ì„ì˜ ê²°ì‹¤ ğŸ‚<br>
                      ê²¨ìš¸ì˜ ì¤€ë¹„ â„ï¸
                    </p>
                  </div>
                  
                  <p>
                    ì•„ì´ë“¤ë„ ê³„ì ˆì²˜ëŸ¼ ìë¼ë‚˜ëŠ” ê±°ì˜ˆìš”.
                  </p>
                  
                  <div class="bg-pink-50 p-4 rounded-xl">
                    <p class="font-semibold text-pink-700">
                      "ìš°ë¦¬ ì‹œìŠ¤í…œìœ¼ë¡œ<br>
                      ì•„ì´ë“¤ì˜ ì„±ì¥ì„ ë„ìš°ì!"
                    </p>
                  </div>
                </div>
              </div>
            `
          },
          {
            emoji: 'â„ï¸',
            title: 'ê²¨ìš¸: ì™„ì„±',
            subtitle: 'ì„¸ìƒì— ë‚˜ì˜¨ ëŠ˜ë´„í†¡í†¡',
            color: 'linear-gradient(135deg, #ddd6fe, #e0e7ff)',
            content: `
              <div class="space-y-6">
                <div class="text-6xl text-center mb-4">â„ï¸ğŸğŸŒŸ</div>
                <div class="text-lg text-gray-800 leading-relaxed space-y-4">
                  <p>
                    ì°¨ê°€ìš´ ê²¨ìš¸,<br>
                    ëŠ˜ë´„í†¡í†¡ì´ ì„¸ìƒì— ë‚˜ì™”ìŠµë‹ˆë‹¤.
                  </p>
                  
                  <p>
                    Sì™€ HëŠ” í•˜ì–€ ëˆˆì„ ë°”ë¼ë³´ë©° ìƒê°í–ˆì£ .
                  </p>
                  
                  <div class="bg-blue-50 p-6 rounded-xl border-l-4 border-blue-400">
                    <p class="text-blue-800 leading-relaxed italic">
                      "ê²¨ìš¸ì´ ìˆì–´ì•¼<br>
                      ë´„ì´ ë” ì•„ë¦„ë‹¤ìš´ ê²ƒì²˜ëŸ¼,<br><br>
                      ìš°ë¦¬ì˜ ë…¸ë ¥ì´ ìˆì–´ì•¼<br>
                      ì•„ì´ë“¤ì˜ ë¯¸ë˜ê°€ ë¹›ë‚  ê±°ì•¼."
                    </p>
                  </div>
                  
                  <p class="text-center text-2xl">
                    ê·¸ë ‡ê²Œ ëŠ˜ë´„í†¡í†¡ì€...<br>
                    ë§ì€ ì•„ì´ë“¤ì—ê²Œ<br>
                    ë”°ëœ»í•œ ë´„ì„ ì„ ë¬¼í–ˆìŠµë‹ˆë‹¤. ğŸ
                  </p>
                </div>
              </div>
            `
          },
          {
            emoji: 'ğŸŒˆ',
            title: 'ë‹¤ì‹œ ë´„',
            subtitle: 'ê³„ì†ë˜ëŠ” ì´ì•¼ê¸°',
            color: 'linear-gradient(135deg, #fce7f3, #fef3c7, #ddd6fe)',
            content: `
              <div class="space-y-6">
                <div class="text-6xl text-center mb-4">ğŸŒˆğŸŒ¸ğŸ’–</div>
                <div class="text-lg text-gray-800 leading-relaxed space-y-4">
                  <p>
                    ê³„ì ˆì€ ëŒê³  ëŒì•„<br>
                    ë‹¤ì‹œ ë´„ì´ ì™”ìŠµë‹ˆë‹¤.
                  </p>
                  
                  <p>
                    ëŠ˜ë´„í†¡í†¡ ë•ë¶„ì— ë§ì€ ì•„ì´ë“¤ì´<br>
                    í–‰ë³µí•œ ë°©ê³¼í›„ë¥¼ ë³´ë‚´ê³  ìˆì–´ìš”.
                  </p>
                  
                  <div class="bg-gradient-to-r from-pink-100 via-purple-100 to-yellow-100 p-6 rounded-xl">
                    <p class="font-bold text-2xl text-center mb-3" style="color: var(--primary-text);">
                      Sì™€ Hì˜ ì—¬ì •ì€ ê³„ì†ë©ë‹ˆë‹¤.
                    </p>
                    <p class="text-center text-gray-700">
                      ì‚¬ê³„ì ˆì²˜ëŸ¼,<br>
                      ëì—†ì´ ìˆœí™˜í•˜ë©° ì„±ì¥í•˜ëŠ”...
                    </p>
                  </div>
                  
                  <div class="text-center space-y-3 pt-4">
                    <p class="text-2xl">ğŸ’</p>
                    <p class="font-semibold text-xl" style="color: var(--highlight-color);">
                      ì§€ê¸ˆ ì´ ìˆœê°„ë„, ì–´ë”˜ê°€ì—ì„œ
                    </p>
                    <p class="text-gray-700">
                      ë‘ ì¹œêµ¬ëŠ” ë” ë‚˜ì€ ì‹œìŠ¤í…œì„ ê¿ˆê¾¸ê³  ìˆë‹µë‹ˆë‹¤.
                    </p>
                  </div>
                  
                  <div class="mt-8 p-6 bg-white rounded-xl shadow-lg border-2" style="border-color: var(--highlight-color);">
                    <p class="text-center text-sm text-gray-600 mb-3">
                      ì´ ì‘ì€ ì´ìŠ¤í„°ì—ê·¸ë¥¼ ë°œê²¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.
                    </p>
                    <p class="text-center font-semibold" style="color: var(--primary-text);">
                      ëª¨ë“  ì•„ì´ë“¤ì´ ëŠ˜ ë´„ì²˜ëŸ¼<br>
                      ë”°ëœ»í•˜ê³  í–‰ë³µí•˜ê¸°ë¥¼...
                    </p>
                    <p class="text-center text-2xl mt-3">ğŸŒ¸</p>
                  </div>
                </div>
              </div>
            `
          }
        ]
      };

      let currentChapter = 0;
      const modal = document.getElementById('trueEndingModal');
      const header = document.getElementById('storyHeader');
      const title = document.getElementById('storyTitle');
      const subtitle = document.getElementById('storySubtitle');
      const content = document.getElementById('storyContent');
      const indicator = document.getElementById('chapterIndicator');
      const prevBtn = document.getElementById('prevChapterBtn');
      const nextBtn = document.getElementById('nextChapterBtn');

      function renderChapter() {
        const chapter = story.chapters[currentChapter];
        
        header.style.background = chapter.color;
        title.textContent = `${chapter.emoji} ${chapter.title}`;
        subtitle.textContent = chapter.subtitle;
        content.innerHTML = chapter.content;
        indicator.textContent = `${currentChapter + 1} / ${story.chapters.length}`;
        
        prevBtn.disabled = currentChapter === 0;
        nextBtn.textContent = (currentChapter === story.chapters.length - 1) ? 'ì´ì•¼ê¸° ë‹«ê¸° ğŸ’' : 'ë‹¤ìŒ â†’';
        
        // ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ
        content.scrollTop = 0;
      }

      prevBtn.onclick = () => {
        if (currentChapter > 0) {
          currentChapter--;
          renderChapter();
          playSound('success');
        }
      };

      nextBtn.onclick = () => {
        if (currentChapter < story.chapters.length - 1) {
          currentChapter++;
          renderChapter();
          playSound('success');
        } else {
          // ë§ˆì§€ë§‰ ì¥ - ì—”ë”© í™”ë©´ìœ¼ë¡œ
          modal.classList.add('hidden');
          showFinalScreen();
        }
      };

      // ì´ˆê¸° ë Œë”ë§
      renderChapter();
      
      document.getElementById('mainForm').classList.add('hidden');
      modal.classList.remove('hidden');
    }

    // ìµœì¢… ì—”ë”© í™”ë©´
    function showFinalScreen() {
      const finalScreen = document.createElement('div');
      finalScreen.className = 'fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4';
      finalScreen.innerHTML = `
        <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full p-12 text-center fade-in">
          <div class="text-7xl mb-6">ğŸŒ¸ğŸ’–ğŸŒ¸</div>
          <h2 class="text-4xl font-bold mb-4" style="color: var(--primary-text);">
            ìš°ë¦¬ì˜ ì´ì•¼ê¸°ëŠ” ê³„ì†ë©ë‹ˆë‹¤
          </h2>
          <p class="text-lg text-gray-700 mb-8 leading-relaxed">
            ë°œê²¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.<br><br>
            ëª¨ë“  ì•„ì´ë“¤ì—ê²Œ ë´„ì´ ì°¾ì•„ì˜¤ê¸°ë¥¼...<br>
            ê·¸ë¦¬ê³  ëª¨ë“  ë¶€ëª¨ë‹˜ì˜ ì‚¬ë‘ì´<br>
            ì•„ì´ë“¤ì˜ ë§ˆìŒì— ë‹¿ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.
          </p>
          <button onclick="location.reload()" class="game-button">
            ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸° ğŸŒ±
          </button>
        </div>
      `;
      
      document.body.appendChild(finalScreen);
    }

    // ==================== ì´ˆê¸°í™” ====================
    document.addEventListener('DOMContentLoaded', () => {
      // ì‹œì‘ ë²„íŠ¼
      document.getElementById('startJourneyBtn').addEventListener('click', () => {
        playSound('unlock');
        document.getElementById('prologueScreen').classList.add('hidden');
        document.getElementById('mainForm').classList.remove('hidden');
      });

      // ê° ìŠ¤í…Œì´ì§€ ì´ˆê¸°í™”
      initStage1();
      initStage2();
      initStage3();
      initStage4();
      initStage5();

      // í¼ ì œì¶œ
      document.getElementById('applicationForm').addEventListener('submit', handleSubmit);
    });
  </script>
</body>
</html>